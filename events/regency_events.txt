namespace = regency

regency.001 = {
	type = character_event
	hidden = yes
	trigger = {
		has_government = feudal_government
	}
	immediate = {
		save_scope_as = invalid_ruler
		hidden_effect = {
			if = {
				limit = {has_character_flag = regent_assigned}
				remove_character_flag = regent_assigned
			}
			every_parent = {
				limit = {is_alive = yes}
				add_to_list = regent_candidates
			}
			every_vassal = {
				add_to_list = regent_candidates
			}
			every_courtier = {
				add_to_list = regent_candidates
			}
			every_heir = {
				limit = {
					NOR = {
						age < 16
						AND = {
							is_male = no
							scope:invalid_ruler = {
								OR = {
									has_realm_law = male_only_law #shouldn't happen
									has_realm_law = male_preference_law
								}
							}
						}
						AND = {
							is_male = yes
							scope:invalid_ruler = {
								OR = {
									has_realm_law = female_only_law #shouldn't happen
									has_realm_law = female_preference_law
								}
							}
						}
					}
				}
				if = {
					limit = {
						is_ruler = yes
						exists = liege
						liege = scope:invalid_ruler
					}
					add_to_list = regent_candidates
				}
				else_if = {
					limit = {is_ruler = no}
					add_to_list = regent_candidates
				}
			}
			random_in_list = {
				list = regent_candidates
				limit = { has_relation_guardian = scope:invalid_ruler }
				alternative_limit = {is_parent_of = scope:invalid_ruler}
				alternative_limit = {is_heir_of = scope:invalid_ruler}
				alternative_limit = {is_powerful_vassal_of = scope:invalid_ruler}
				alternative_limit = {is_vassal_of = scope:invalid_ruler}
				alternative_limit = {is_courtier_of = scope:invalid_ruler}
				add_character_flag = is_assigned_regent
				clear_variable_list = regent_assigned_to
				add_to_variable_list = { name = regent_assigned_to target = scope:invalid_ruler }
				if = {
					limit = {scope:invalid_ruler = { age < 16 } }
					set_relation_ward = scope:invalid_ruler
				}
				if = {
					limit = {is_ruler = no}
					set_employer = scope:invalid_ruler
				}
			}
			add_character_flag = regent_assigned
		}
	}
}
regency.002 = {
	hidden = yes
	immediate = {
		every_in_list = {
			variable = regent_assigned_to
			trigger_event = regency.001
		}
	}
}